# 13-1 교착 상태란
교착상태란? 두 개 이상의 프로세스가 각자 가지고 있는 자원을 무작정 기달리면서 더 이상 프로세스가 진행 할 수 없는 상태를 말합니다.

## 자원 할당 그래프
교착 상태는 자원 할당 그래프(`resource-allocation graph`)를 통해서 표현할 수 있습니다.

자원 할당 그래프는 다음과 같은 규칙을 따릅니다.
1. 프로세스는 원으로, 자원의 종류는 사각형으로 표현합니다.
2. 사용할 수 있는 자원의 개수는 자원 사각형 내에 점으로 표현합니다.
3. 프로세스가 어떤 자원을 할당받아 사용 중이라면 자우너에서 프로세스를 향해 화살표로 표현합니다.
4. 프로세스가 어떤 자원을 기달리고 있다면 프로세스에서 자원으로 화살표를 표시합니다.

## 교착 상태 발생 조건
교착 상태가 발생한 원인은 무엇인가요? 4가지 조건에 의해서 발생합니다.
1. 상호배제
2. 점유와 대기
3. 비선점
4. 원형 대기

### 상호 배제
현 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없을 때 상호배제 상황에서 교착 상태가 발생 할 수 있습니다.

### 비선점
비선점 자원은 그 자원을 이용하는 프로세스의 작업이 끝나야만 비로소 이용할 수 있습니다. 어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못했기 때문에 교착 상태가 발생합니다.

### 점유와 대기
프로세스도 마찬가지로 어떤 자원을 할당받은 상태에서 다른 자원을 할당받기를 기다린다면 교착 상태가 발생합니다.

### 원형 대기
프로세스들과 프로세스가 요청 및 할당받은 자원의 원의 형태로 이뤄져 있습니다. 프로세스들이 원의 형태로 자원을 대기하는 것을 원형 대기라고 합니다.

# 13-2 교착 상태 해결 방법
교착 상태는 마치 교통 도로에서 꼼짝 못 하는 상황입니다. 이 문제를 회피하기 위해서는 예방, 회피 검출 후 회복 이 있습니다.

교착 상태 발생 조건에 부합하지 않게 자원을 분배하여 교착 상태를 예방 할 수 있고, 교착 상태가 발생하지 않도록 조금씩 자원을 할당하다가 교착 상태의 위험이 있다면 자원을 할당하지 않은 방식으로 회피를 할 수 있습니다.
자원을 제약 없이 할당하다가 교착 상태가 검출되면 교착 상태를 회복하는 방법을 취할 수 있습니다.

## 교착 상태 예방
교착 상태 예방하는 방법은 교착 상태 발생 필요 조건 네 가지 중 하나를 충족 하지 못하게 하는 것입니다.
상호배제, 점유와 대기, 비선점, 원형 대기 중 하나의 조건만 성립 하지 않으면 교착 생태를 발생하지 않습니다.

### 상호배제를 없앤다면?
자원의 상호 배제를 없앤다는 것은 모든 자원을 공유 가능하게 만드는 것과 같습니다. 이론적으로는 가능 할지 몰라도 현실적으로는 어려운 일입니다.

### 점유와 대기를 없앤다면?
점유와 대기를 없앤다면 특정 프로세스에 자원을 모두 할당하거나, 아예 할당하지 않는 방식으로 배분합니다.
이론적으로는 교착 상태를 해결 할 수 있지만, 우선 자원의 활용률이 낮아질 우려가 있습니다.

### 비선점 조건을 없앤다면?
비선점 조건을 없애면 자원을 이용 중인 프로세스로부터 해당 자원을 빼앗을 수 있습니다.
이 방식은 선점하여 사용할 수 있는 일부 자원에 대해서 효과적입니다. 그렇지만 비선점 조건을 없애 모든 자원을 빼앗을 수 있도록 교착상태를 예방하는 것은 범용성이 떨어집니다.

### 원형 대기 조건을 없앤다면?
원형 대기를 없앤다면 모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당하면 원형 대기를 발생하지 않습니다.
사각형 식탁에서 일렬로 앉아 식사하는 상황과 같습니다.

## 교착 상태 회피
교착 상태 회피는 교착 상태가 발생하지 않도록 조심 자원을 할당하는 방식입니다.
교착 상태를 한정된 자원의 무분별한 할당으로 인해 발생하는 문제로 간주합니다.

프로세스들에 배분할 수 있는 자원의 양을 고려하여 교착 상태가 발생하지 않을 정도의 양만큼만 자원을 배분하는 방법이 **교착 상태 회피**입니다.

교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태를 **안전상태**
교착 상태가 발생할 수 있는 상황을 **불안전 상태**
교착 상태 없이 안전하게 프로세스들에 자원을 할당 할 수 있는 순서를 **안전 순서열**

## 교착 상태 검출 후 회복
교착 상태 검출 후 회복은 교착 상태 발생을 인정하고 사후에 조치하는 방식입니다.

### 선점을 통한 회복
선점을 통한 회복은 교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식입니다.

### 프로세스 강제 종료를 통한 회복
운영체제는 교착 상태에 놓인 프로세스를 모두 강제 종료할 수 있고, 교착 상태가 없어질 때까지 한 프로세스씩 강제 종료할 수도 있습니다.
