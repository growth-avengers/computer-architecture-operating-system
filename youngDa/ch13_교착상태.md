# ch13. 교착 상태

## 13-1. 교착 상태란

### 식사하는 철학자 문제(dining philosophers problem)

1. 생각을 하다가 왼쪽 포크가 사용 가능하면 집어든다
2. 생각을 하다가 오른쪽 포크가 사용 가능하면 집어든다
3. 왼쪽과 오른쪽 포크를 모두 집어들면 정해진 시간동안 식사를 한다.
4. 식사 시간이 끝나면 오른쪽 포크를 내려놓는다.
5. 오른쪽 포크를 내려놓은뒤 왼쪽 포크를 내려놓는다.
6. 1~5 과정을 반복한다.

=> 모든 철학자가 동시에 포크를 집어 식사를 하면 어떤 철학자도 식사를 할 수 없고 영원히 생각만 하는 상황 발생 (모두가 오른쪽 포크를 들 수 없기 때문. 모두가 포크를 내려놓기를 기다림)

- 교착상태(deadlock) : 일어나지 않을 사건을 기다리며 진행이 멈춰버리는 현상
  - 교착 상태를 해결하기 위해서는 1. 교착 상태가 발생했을 때의 상황을 정확히 표현하고, 2. 교착 상태가 일어나는 근본적인 이유를 알아야 함

### 자원 할당 그래프(resource-allocation graph)

1. 프로세스는 원으로, 자원 종류는 사각형으로 표현
2. 사용할 수 있는 자원의 개수는 자원 사각형 내에 점으로 표현
3. 프로세스가 어떤 자원을 할당받아 사용중이면 프로세스를 향해 화살표를 표시
4. 프로세스가 어떤 자원을 기다리고 있다면 프로세스에서 자원으로 화살표를 표시

**교착상태가 일어나는 그래프의 특징**

- 자원 할당 그래프가 원으로 발생

### 교착 상태 발생 조건

- 상호 배제(mutual exclusion)
  - 한 프로세스 사용하는 자원을 다른 프로세스가 사용할 수 없을 때
- 점유와 대기(hold and wait)
  - 자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 상태
- 비선점(nonpreemptive)
  - 자원을 이용하는 프로세스 작업이 끝나야만 이용 가능(다른 프로세스 자원 강제로 뺏는 것이 불가)
- 원형 대기(circular wait)
  - 자원할당그래프가 원으로 그려짐

## 13-2. 교착상태 해결 방법

### 교착 상태 예방

상호배제를 없애는 방법

- 모든 자원을 공유 가능하게 함
- 현실적으로 는 사용 불가

점유와 대기를 없애는 방법

- 철학자 문제에서 포크를 모두 동시에 들게 하거나 아예 들지 못하게 하거나 함.
- 운영체제가 자원을 특정 프로세스에 자원을 모두 할당하거나 아예 할당하지 않는 방식으로 배분
- 단점 : 자원 활용률이 낮아짐
  - 특정 프로세스에 자원 몰아주는 식. 당장 자원이 필요해도 기다리는 프로세스 & 필요하지 않아도 자우너 할당받는 프로세스
  - 많은 자원 필요로 하는 프로세스가 무한정 대기하는 기아 현상 발생

비선점 없애는 방법

- 일부 자원에서는 효과적
- CPU : 프로세스들이 선점할 수 있는 대표적 자원
- 프린터는 불가
  - 범용성이 떨어지는 방법

원형 대기 조건 없애는 방법

- 모든 자원에 번호를 붙이고 오름차순으로 자원을 할당
- 각 자원에 어떤 번호를 붙이는지에 따라 특정 자원의 활용률이 떨어짐

\*교착상태 조건을 제거해서 교착상태를 방지하는 방식은 교착상태가 발생하지 않게 할 수는 있지만 여러 부작용이 발생

### 교착 상태 회피

교착상태가 발생하지 않을 정도로만 자원을 할당하는 방식.

- 안전 상태 (safe state) : 프로세스가 정상적으로 자원 할당받고 종료될 수 있는 상태
  - 안전 순서열대로 프로세스들에 자원 배분하여 =교착 상태가 발생하지 않는 상태
- 불안전 상태(unsafe state) : 교착 상태가 발생 할 수도 있는 상태

  - 안전 순셔열이 없는 상황

- 안전 순서열(safe sequence) : 교착 상태 없이 안전하게 프로세스들에 자원을 할당 할 수 있는 순서

### 교착 상태 검출 후 회복

- 선점을 통한 회복
  - 교착 상태가 해결될 때 까지 한 프로세스씩 자원을 몰아주는 방식
- 프로세스 강제 종료를 통한 회복
  - 교착 상태에 놓인 프로세스 모두 강제 종료 : 확실하게 교착 상태 해결 가능하지만 작업 내역 잃을 수 있음
  - 교착 상태 없을 때 까지 한 프로세스씩 강제 종료 : 작업 내역 잃는 프로세스 최대한 줄이지만 교착 상태 없어졌는지 여부 확인하는 과정에서 오버헤드 야기
- 타조 알고리즘 : 무시

# 내 생각

- 지난 CS 기초 스터디에서도 교착 상태가 나왔는데, 교착 상태를 어떤 방식으로 회피하는지, 검출 후에 회복하는 방식은 어떤 것이 있는지 이번 기회에 제대로 배운 것 같아서 재미있었습니다.

# 논의할 내용

- 어떤 프로세스에 대해서 어떤 교착 상태 해결 방식을 써야 할까요?
